<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>千星奇域关卡数据提取</title><link rel="icon" href="favicon.23060f3d.ico" type="image/x-icon"><link href="https://jsdmirrors.aino.cyou/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" rel="stylesheet"><link href="https://jsdmirrors.aino.cyou/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"><script src="https://jsdmirrors.aino.cyou/npm/exceljs@4.4.0/dist/exceljs.min.js"></script><script src="https://jsdmirrors.aino.cyou/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script><style>:root{--primary-color:#4a90e2;--bg-color:#f0f2f5}body{background-color:var(--bg-color);background-image:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding-bottom:50px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,PingFang SC,Microsoft YaHei,Arial,sans-serif}.main-container{max-width:1150px;margin:40px auto;padding:0 15px}.glass-card{backdrop-filter:blur(10px);background:#fffffff2;border:1px solid #ffffff2e;border-radius:16px;margin-bottom:20px;padding:30px;box-shadow:0 8px 32px #1f268726}.input-area textarea{border:2px solid #e0e0e0;border-radius:12px;font-family:monospace;font-size:14px}.input-area textarea:focus{box-shadow:none;border-color:var(--primary-color)}.result-wrapper{background:#fff;border-radius:12px;margin-top:20px;padding:30px;overflow:hidden;box-shadow:0 4px 12px #0000000d}.export-header{border-bottom:2px solid #eee;justify-content:space-between;align-items:flex-end;margin-bottom:20px;padding-bottom:15px;display:flex}.title-group{align-items:center;width:50%;display:flex}.title-icon{object-fit:contain;flex-shrink:0;width:48px;height:48px;margin-right:15px}.export-title{color:#333;cursor:text;background:0 0;border-bottom:1px dashed #0000;outline:none;width:100%;padding:2px 0;font-size:26px;font-weight:800;line-height:1.4}.export-title:hover,.export-title:focus{border-bottom-color:#ccc}.header-controls{flex-direction:column;align-items:flex-end;gap:8px;display:flex}.sort-toggle{font-size:12px}.btn-check:checked+.btn-outline-primary{background-color:var(--primary-color);color:#fff;border-color:var(--primary-color)}.export-meta{text-align:right;color:#888;min-width:150px;font-size:13px;line-height:1.6}.custom-table{border-collapse:separate;border-spacing:0;width:100%;margin-bottom:0}.custom-table thead th{color:#555;text-align:left;white-space:nowrap;background-color:#f8f9fa;border-bottom:2px solid #eee;padding:15px 12px;font-size:14px;font-weight:700}.custom-table tbody td{vertical-align:middle;background-color:#fff;border-bottom:1px solid #f0f0f0;padding:12px}.avatar-img{object-fit:cover;vertical-align:middle;border:1px solid #eee;border-radius:50%;width:38px;height:38px;margin-right:10px}.cover-img{object-fit:cover;border:1px solid #e0e0e0;border-radius:6px;width:96px;height:54px;display:block}.author-box{align-items:center;display:flex}.level-name{color:#333;margin-bottom:5px;font-size:15px;font-weight:700;line-height:1.3}.badge-custom{border-radius:4px;margin-right:4px;padding:3px 8px;font-size:11px;font-weight:500;display:inline-block}.badge-type{color:#1565c0;background-color:#e3f2fd}.badge-cat{color:#6a1b9a;background-color:#f3e5f5}.badge-id{color:#666;background:#f8f9fa;border:1px solid #eee;border-radius:6px;align-items:center;padding:6px 8px;font-family:Consolas,Monaco,monospace;font-size:13px;display:inline-flex}.badge-id i{color:#aaa;margin-right:5px}.copy-btn{cursor:pointer;color:#bbb;margin-left:8px;transition:color .2s}.copy-btn:hover{color:var(--primary-color)}.copy-btn:active{transform:scale(.95)}.badge-players{color:#2e7d32;white-space:nowrap;vertical-align:middle;background:#e8f5e9;border-radius:20px;padding:6px 12px;font-size:13px;font-weight:700;display:inline-block}.badge-players i{margin-right:5px}.stat-item{color:#666;white-space:nowrap;align-items:center;margin-bottom:3px;font-size:13px;display:flex}.stat-item i{text-align:center;width:20px;margin-right:4px}.text-hot{color:#ff7043}.text-rate{color:#ffa000}.loading-spinner{margin-left:10px;display:none}.result-footer{color:#999;border-top:1px solid #eee;justify-content:space-between;align-items:center;margin-top:25px;padding-top:15px;font-size:12px;display:flex}.footer-link{color:#999;font-weight:700;text-decoration:none}.footer-link:hover{color:var(--primary-color);text-decoration:underline}.source-link{color:#999;font-weight:700;text-decoration:none;transition:color .2s}.source-link:hover{color:var(--primary-color)}.error-row td{color:#d32f2f;background-color:#fff5f5;padding:20px;font-size:13px}.status-checkbox{cursor:pointer;width:20px;height:20px;accent-color:var(--primary-color)}#currentProfileDisplay{color:#666;background:#e9ecef;border-radius:20px;margin-right:10px;padding:5px 12px;font-size:14px;display:inline-block}</style></head><body><div class="main-container"><div class="glass-card"><div class="align-items-center d-flex justify-content-between mb-4"><h3 class="fw-bold m-0" style="color:#333"><i class="fa-solid fa-star text-warning"></i> 千星奇域关卡数据提取</h3><div><span id="currentProfileDisplay"><i class="fa-folder-open fa-solid"></i> 默认存档</span> <button class="btn btn-outline-secondary btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#saveManagerModal"><i class="fa-floppy-disk fa-solid"></i> 存档管理</button></div></div><div class="input-area mb-3"><label for="dataInput" class="form-label text-muted">请输入列表 (格式: ID 或 ID:备注，一行一个)</label> <textarea class="form-control" id="dataInput" rows="5"></textarea></div><div class="align-items-center d-grid d-md-flex gap-2 justify-content-md-end"><div class="align-items-center d-inline-flex form-check form-switch me-3" title="勾选后忽略缓存，直接从服务器获取最新数据"><input class="form-check-input" type="checkbox" role="switch" id="forceRefresh"> <label class="form-check-label ms-2 small text-secondary" for="forceRefresh">强制刷新</label></div><button class="btn btn-primary fw-bold px-4 rounded-pill" type="button" id="btnStart"><i class="fa-magnifying-glass fa-solid"></i> 开始提取 <span class="loading-spinner spinner-border spinner-border-sm" id="spinner"></span></button></div></div><div id="captureArea" class="result-wrapper" style="display:none"><div class="export-header"><div class="title-group"><img src="nahida.926abf00.png" class="title-icon" alt="icon" crossorigin><div class="export-title" contenteditable="true" spellcheck="false">关卡统计列表</div></div><div class="header-controls"><div class="btn-group sort-toggle" role="group" id="sortControl" style="display:none"><input type="radio" class="btn-check" name="sortMode" id="sortOriginal" value="original" checked> <label class="btn btn-outline-primary btn-sm" for="sortOriginal"><i class="fa-list-ol fa-solid"></i> 原始排序</label> <input type="radio" class="btn-check" name="sortMode" id="sortPlayers" value="players"> <label class="btn btn-outline-primary btn-sm" for="sortPlayers"><i class="fa-arrow-down-short-wide fa-solid"></i> 人数排序</label></div><div class="export-meta"><div>生成时间: <strong id="genTime">-</strong></div><div>项目数量: <strong id="countBadge">0</strong></div></div></div></div><div class="table-responsive"><table class="custom-table" id="resultTable"><thead><tr><th width="100">封面</th><th width="150">作者</th><th width>关卡信息</th><th width="150">关卡ID</th><th width="100">热度/好评</th><th width="110" class="text-center">游玩人数</th><th width="60" class="text-center" title="标记是否已玩过">状态</th></tr></thead><tbody id="tableBody"></tbody></table></div><div class="result-footer"><div>Generated by <a href="https://github.com/luluxiaoyu/genshin-ugc-stage-tool" target="_blank" class="footer-link">Genshin UGC stage Tools </a></div><div class="text-end">数据来源：<a href="https://www.miyoushe.com/ys/" target="_blank" class="source-link">miyoushe</a></div></div></div><div class="d-flex gap-3 justify-content-center mt-4 text-center" id="actionButtons" style="display:none"><button class="btn btn-success fw-bold px-4 py-2 rounded-pill shadow-sm" id="btnExportExcel"><i class="fa-file-excel fa-solid"></i> 导出 Excel <span class="spinner-border spinner-border-sm" id="excelSpinner" style="display:none"></span></button> <button class="btn btn-primary fw-bold px-4 py-2 rounded-pill shadow-sm" id="btnDownload"><i class="fa-image fa-solid"></i> 保存高清长图</button></div></div><div class="fade modal" id="saveManagerModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"><i class="fa-box-archive fa-solid"></i> 存档管理</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="d-flex justify-content-between mb-3"><button class="btn btn-primary btn-sm" onclick="SaveManager.createNewProfile()"><i class="fa-plus fa-solid"></i> 新建存档</button><div><button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('importFile').click()"><i class="fa-file-import fa-solid"></i> 导入</button> <button class="btn btn-outline-secondary btn-sm" onclick="SaveManager.exportData()"><i class="fa-file-export fa-solid"></i> 备份</button> <input type="file" id="importFile" style="display:none" accept=".json" onchange="SaveManager.importData(this)"></div></div><ul class="list-group" id="profileList"></ul></div></div></div></div><div class="bottom-0 end-0 p-3 position-fixed" style="z-index:11"><div id="copyToast" class="align-items-center bg-success border-0 text-white toast" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body"><i class="fa-check-circle fa-solid me-2"></i> ID 已复制到剪贴板</div><button type="button" class="btn-close btn-close-white m-auto me-2" data-bs-dismiss="toast" aria-label="Close"></button></div></div></div><script src="https://jsdmirrors.aino.cyou/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script><script src="https://jsdmirrors.aino.cyou/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script><script>const SaveManager={STORAGE_KEY:"genshin_ugc_save_data_v1",data:{currentProfileId:"default",profiles:{default:{name:"默认存档",playedLevels:[]}}},init(){let e=localStorage.getItem(this.STORAGE_KEY);if(e)try{this.data=JSON.parse(e)}catch(e){console.error("存档解析失败，重置为默认",e)}this.updateUI(),this.renderModalList()},save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.data)),this.updateUI()},updateUI(){let e=this.data.profiles[this.data.currentProfileId]?.name||"未知存档";document.getElementById("currentProfileDisplay").innerHTML=`<i class="fa-solid fa-folder-open"></i> ${e}`},getPlayedStatus(e){return(this.data.profiles[this.data.currentProfileId].playedLevels||[]).includes(e.toString())},togglePlayed(e,t){let a=e.toString(),r=this.data.profiles[this.data.currentProfileId];r.playedLevels||(r.playedLevels=[]),t?r.playedLevels.includes(a)||r.playedLevels.push(a):r.playedLevels=r.playedLevels.filter(e=>e!==a),this.save()},createNewProfile(){let e=prompt("请输入新存档名称：");if(e){let t="prof_"+Date.now();this.data.profiles[t]={name:e,playedLevels:[]},this.switchProfile(t),this.renderModalList()}},switchProfile(e){this.data.profiles[e]&&(this.data.currentProfileId=e,this.save(),this.renderModalList(),sortAndRender())},deleteProfile(e){Object.keys(this.data.profiles).length<=1?alert("至少需要保留一个存档！"):confirm("确定要删除这个存档吗？此操作不可恢复。")&&(delete this.data.profiles[e],this.data.currentProfileId===e&&(this.data.currentProfileId=Object.keys(this.data.profiles)[0]),this.save(),this.renderModalList(),sortAndRender())},exportData(){let e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.data)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","genshin_stage_backup_"+Date.now()+".json"),document.body.appendChild(t),t.click(),t.remove()},importData(e){let t=e.files[0];if(!t)return;let a=new FileReader;a.onload=t=>{try{let e=JSON.parse(t.target.result);e.profiles&&e.currentProfileId?(this.data=e,this.save(),this.renderModalList(),sortAndRender(),alert("导入成功！")):alert("无效的存档文件格式")}catch(e){alert("文件解析失败")}e.value=""},a.readAsText(t)},renderModalList(){let e=document.getElementById("profileList");e.innerHTML="",Object.keys(this.data.profiles).forEach(t=>{let a=this.data.profiles[t],r=t===this.data.currentProfileId,l=document.createElement("li");l.className=`list-group-item d-flex justify-content-between align-items-center ${r?"list-group-item-primary":""}`,l.innerHTML=`
                    <div style="cursor:pointer; flex-grow:1" onclick="SaveManager.switchProfile('${t}')">
                        ${r?'<i class="fa-solid fa-check text-primary me-2"></i>':'<i class="fa-regular fa-circle me-2 text-muted"></i>'}
                        <span class="fw-bold">${a.name}</span>
                        <span class="badge bg-secondary rounded-pill ms-2">${a.playedLevels?.length||0}</span>
                    </div>
                    ${!r?`<button class="btn btn-xs btn-outline-danger ms-2" style="padding: 2px 6px; font-size:12px" onclick="SaveManager.deleteProfile('${t}')"><i class="fa-solid fa-trash"></i></button>`:""}
                `,e.appendChild(l)})}},btnStart=document.getElementById("btnStart"),btnDownload=document.getElementById("btnDownload"),btnExportExcel=document.getElementById("btnExportExcel"),excelSpinner=document.getElementById("excelSpinner"),inputArea=document.getElementById("dataInput"),tableBody=document.getElementById("tableBody"),captureArea=document.getElementById("captureArea"),actionButtons=document.getElementById("actionButtons"),spinner=document.getElementById("spinner"),countBadge=document.getElementById("countBadge"),genTimeSpan=document.getElementById("genTime"),sortControl=document.getElementById("sortControl"),sortRadios=document.querySelectorAll('input[name="sortMode"]'),toastEl=document.getElementById("copyToast"),bsToast=new bootstrap.Toast(toastEl),forceRefreshCheckbox=document.getElementById("forceRefresh"),LINE_REGEX=/^(\d+)(?:[:：].*)?$/,CACHE_DURATION=108e5;let globalResults=[];function checkUrlParams(){let e=new URLSearchParams(window.location.search).get("ids");e&&(inputArea.value=e.split(",").join("\n"),setTimeout(()=>{inputArea.value.trim()&&btnStart.click()},200))}SaveManager.init();const getProxyUrl=e=>{if(!e)return"https://via.placeholder.com/100x56?text=N/A";try{let t=btoa(e);return`/proxy-image/${encodeURIComponent(t)}.png`}catch(e){return console.error("Base64 encode failed",e),"https://via.placeholder.com/100x56?text=Err"}},fetchImageAsBase64=async e=>{if(!e)return null;let t=getProxyUrl(e);try{let e=await fetch(t),a=await e.blob();return new Promise(e=>{let t=new FileReader;t.onloadend=()=>{let a=t.result;e(a)},t.readAsDataURL(a)})}catch(t){return console.warn("Failed to fetch image for Excel:",e),null}};async function fetchWithRetry(e,t=3,a=!1){let r=`stage_data_${e}`;if(!a){let t=localStorage.getItem(r);if(t)try{let a=JSON.parse(t);if(Date.now()-a.timestamp<108e5)return{isSuccess:!0,data:a.data,id:e}}catch(e){localStorage.removeItem(r)}}let l=0,o="Unknown";for(;l<=t;)try{l>0&&await new Promise(e=>setTimeout(e,1500));let t=await fetch(`/guid?id=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error(`HTTP ${t.status}`);let a=await t.json();if(a&&a.success&&a.data){let t={timestamp:Date.now(),data:a.data};try{localStorage.setItem(r,JSON.stringify(t))}catch(e){}return{isSuccess:!0,data:a.data,id:e}}throw Error(a.error||"API Logic Error")}catch(t){console.warn(`ID ${e} attempt ${l+1} failed:`,t.message),o=t.message,l++}return{isSuccess:!1,id:e,error:o}}function sortAndRender(){let e=document.querySelector('input[name="sortMode"]:checked').value,t=globalResults.filter(e=>null!=e);if(0===t.length){tableBody.innerHTML='<tr><td colspan="7" class="text-center py-4">无有效数据</td></tr>';return}let a=[...t];"original"===e?a.sort((e,t)=>e.originalIndex-t.originalIndex):a.sort((e,t)=>{if(e.isSuccess!==t.isSuccess)return e.isSuccess?-1:1;if(e.isSuccess){let a=e.data,r=t.data,l=void 0!==a.sortMin?a.sortMin:999,o=void 0!==r.sortMin?r.sortMin:999,n=void 0!==a.sortMax?a.sortMax:999,s=void 0!==r.sortMax?r.sortMax:999;return l!==o?l-o:n-s}return 0}),tableBody.innerHTML="",a.forEach(e=>{e.isSuccess?renderRow(e.data):renderErrorRow({levelId:e.id,msg:`\u{83B7}\u{53D6}\u{5931}\u{8D25}: ${e.error}`})})}function renderRow(e){if(!e)return;let t=document.createElement("tr"),a=getProxyUrl(e.authorAvatar),r=getProxyUrl(e.coverUrl),l=e.hotScore?`<div class="stat-item text-hot"><i class="fa-solid fa-fire"></i> ${e.hotScore}</div>`:"",o=e.goodRate?`<div class="stat-item text-rate"><i class="fa-solid fa-thumbs-up"></i> ${e.goodRate}</div>`:"",n=SaveManager.getPlayedStatus(e.levelId);t.innerHTML=`
            <td>
                <img src="${r}" class="cover-img" alt="\u{5C01}\u{9762}" crossorigin="anonymous">
            </td>
            <td>
                <div class="author-box">
                    <img src="${a}" class="avatar-img" alt="\u{5934}\u{50CF}" crossorigin="anonymous">
                    <div class="fw-bold small text-truncate" style="max-width: 120px;">${e.authorName||"未知"}</div>
                </div>
            </td>
            <td>
                <div class="level-name">${e.levelName||"未知"}</div>
                <div class="d-block">
                    <span class="badge-custom badge-type">${e.type||"-"}</span>
                    <span class="badge-custom badge-cat">${e.category||"-"}</span>
                </div>
            </td>
            <td>
                <span class="badge-id">
                    <i class="fa-solid fa-fingerprint"></i>${e.levelId}
                    <i class="fa-regular fa-copy copy-btn" onclick="copyId('${e.levelId}')" title="\u{590D}\u{5236}ID"></i>
                </span>
            </td>
            <td>
                <div class="d-flex flex-column">
                    ${l}
                    ${o}
                </div>
            </td>
            <td class="text-center">
                <span class="badge-players">
                    <i class="fa-solid fa-users"></i> ${e.playersStr||"N/A"}
                </span>
            </td>
            <td class="text-center">
                <input type="checkbox" class="status-checkbox" ${n?"checked":""} onchange="toggleStatus(this, '${e.levelId}')">
            </td>
        `,tableBody.appendChild(t)}function renderErrorRow(e){let t=document.createElement("tr");t.className="error-row",t.innerHTML=`
            <td colspan="7" class="text-center">
                <i class="fa-solid fa-circle-exclamation me-1"></i> 
                ID: <strong>${e.levelId}</strong> - ${e.msg}
            </td>
        `,tableBody.appendChild(t)}sortRadios.forEach(e=>{e.addEventListener("change",()=>{sortAndRender()})}),btnStart.addEventListener("click",async()=>{let e=inputArea.value.trim(),t=forceRefreshCheckbox.checked;if(!e)return alert("请输入内容");tableBody.innerHTML="",globalResults=[],captureArea.style.display="block",actionButtons.className="text-center mt-4 d-flex justify-content-center gap-3",actionButtons.style.display="none",sortControl.style.display="none",btnStart.disabled=!0,spinner.style.display="inline-block",document.getElementById("sortOriginal").checked=!0,genTimeSpan.innerText=new Date().toLocaleString("zh-CN",{hour12:!1});let a=e.split(/\n/).map(e=>e.trim()).filter(e=>e),r=[];if(a.forEach(e=>{let t=e.match(LINE_REGEX);t&&r.push(t[1])}),r.length>0){let e=new URL(window.location);e.searchParams.set("ids",r.join(",")),window.history.replaceState({},"",e)}let l=0,o=a.map(async(e,r)=>{let o=e.match(LINE_REGEX);if(!o)return null;let n=o[1],s=await fetchWithRetry(n,3,t),i={...s,originalIndex:r};return globalResults.push(i),l++,countBadge.innerText=`${l} / ${a.length}`,s.isSuccess?renderRow(s.data):renderErrorRow({levelId:s.id,msg:"获取失败"}),i}).filter(e=>null!==e);try{await Promise.all(o),sortAndRender(),countBadge.innerText=`${globalResults.length}`,actionButtons.style.display="flex",sortControl.style.display="inline-flex"}catch(e){console.error("Critical Error:",e),alert("程序发生严重错误")}finally{btnStart.disabled=!1,spinner.style.display="none"}}),window.copyId=e=>{navigator.clipboard.writeText(e).then(()=>{bsToast.show()}).catch(e=>{console.error("Copy failed",e),alert("复制失败，请手动复制")})},window.toggleStatus=(e,t)=>{SaveManager.togglePlayed(t,e.checked)},btnExportExcel.addEventListener("click",async()=>{btnExportExcel.disabled=!0,excelSpinner.style.display="inline-block";try{let e=new ExcelJS.Workbook;e.creator="Genshin UGC Tool",e.created=new Date;let t=e.addWorksheet("关卡数据",{views:[{showGridLines:!1}]});t.columns=[{header:"封面图",key:"cover",width:22},{header:"序号",key:"index",width:6},{header:"关卡ID",key:"id",width:15},{header:"关卡名称",key:"name",width:25},{header:"作者",key:"author",width:15},{header:"类型",key:"type",width:12},{header:"标签",key:"cat",width:12},{header:"热度",key:"hot",width:10},{header:"好评",key:"rate",width:10},{header:"游玩人数",key:"players",width:12},{header:"状态",key:"status",width:10}];let a=t.getRow(1);a.font={name:"微软雅黑",size:12,bold:!0,color:{argb:"FFFFFFFF"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4A90E2"}},a.alignment={vertical:"middle",horizontal:"center"},a.height=30;let r=document.querySelector('input[name="sortMode"]:checked').value,l=[...globalResults.filter(e=>null!=e&&e.isSuccess)];"original"===r?l.sort((e,t)=>e.originalIndex-t.originalIndex):l.sort((e,t)=>{let a=e.data,r=t.data,l=a.sortMin||999,o=r.sortMin||999,n=a.sortMax||999,s=r.sortMax||999;return l!==o?l-o:n-s});for(let a=0;a<l.length;a++){let r=l[a].data,o=SaveManager.getPlayedStatus(r.levelId),n=t.addRow({cover:"",index:a+1,id:r.levelId,name:r.levelName||"未知",author:r.authorName||"未知",type:r.type||"-",cat:r.category||"-",hot:r.hotScore||"",rate:r.goodRate||"",players:r.playersStr||"",status:o?"★ 已玩":"未玩"});n.height=60,n.alignment={vertical:"middle",horizontal:"center"},n.eachCell({includeEmpty:!0},e=>{e.border={top:{style:"thin",color:{argb:"FFEEEEEE"}},left:{style:"thin",color:{argb:"FFEEEEEE"}},bottom:{style:"thin",color:{argb:"FFEEEEEE"}},right:{style:"thin",color:{argb:"FFEEEEEE"}}}}),n.getCell("id").font={name:"Consolas",bold:!0,size:11},n.getCell("name").font={name:"微软雅黑",bold:!0,size:11};let s=n.getCell("status");if(o?s.font={color:{argb:"FF2E7D32"},bold:!0}:s.font={color:{argb:"FF999999"}},r.coverUrl){let l=await fetchImageAsBase64(r.coverUrl);if(l){let r=e.addImage({base64:l,extension:"png"});t.addImage(r,{tl:{col:.1,row:a+1+.1},ext:{width:128,height:72},editAs:"oneCell"})}}}let o=await e.xlsx.writeBuffer(),n=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=`\u{5343}\u{661F}\u{5947}\u{57DF}_\u{8BE6}\u{7EC6}\u{5173}\u{5361}\u{6570}\u{636E}_${new Date().toISOString().slice(0,10)}.xlsx`;saveAs(n,s)}catch(e){console.error(e),alert("导出 Excel 失败，请检查网络或重试。")}finally{btnExportExcel.disabled=!1,excelSpinner.style.display="none"}}),btnDownload.addEventListener("click",()=>{genTimeSpan.innerText=new Date().toLocaleString("zh-CN",{hour12:!1}),window.scrollTo(0,0),html2canvas(captureArea,{scale:2,backgroundColor:"#ffffff",useCORS:!0,allowTaint:!0,logging:!1,scrollY:-window.scrollY}).then(e=>{let t=document.createElement("a");t.download=`\u{5343}\u{661F}\u{5947}\u{57DF}\u{6570}\u{636E}_${new Date().getTime()}.png`,t.href=e.toDataURL("image/png"),t.click()}).catch(e=>{alert("生成失败"),console.error(e)})}),window.onload=checkUrlParams;</script></body></html>